!function(){var t={me:{ja:"私",en:"me",zh:"我"},you:{ja:"あなた",en:"you",zh:"你"}};const e=60,i=245,s="hsl(0, 75%, 65%)",n="hsl(180, 75%, 65%)",o="rgba(245, 245, 245, 0.05)";var r,a,l,h,d,c,u,w,f,m;(a=r||(r={}))[a.First=0]="First",a[a.Second=1]="Second",(h=l||(l={}))[h.Play=0]="Play",h[h.GameSet=1]="GameSet",(c=d||(d={}))[c.Init=0]="Init",c[c.Play=1]="Play",c[c.GameSet=2]="GameSet",(w=u||(u={}))[w.Play=0]="Play",w[w.Done=1]="Done",w[w.Abort=2]="Abort",(m=f||(f={}))[m.ToggleField=0]="ToggleField",m[m.ToggleTurn=1]="ToggleTurn";class y{listeners=new Map;onceListeners=new Map;on(t,e){let i=this.listeners.get(t)??[];i.push(e),this.listeners.set(t,i)}onOnce(t,e){let i=this.onceListeners.get(t)??[];i.push(e),this.onceListeners.set(t,i)}emit(t,...e){let i=this.listeners.get(t)??[];for(let t of i)t(...e);i=this.onceListeners.get(t)??[];for(let t of i)t(...e);this.onceListeners.delete(t)}}class g extends y{static doneAll(t,e){const i=t.length;let s=0;t.forEach((t=>{t.onOnce(u.Done,(()=>{s+=1,i<=s&&e()}))}))}static playParallel(t,e){if(0!==t.length)return t.length<=1?O(t).play():(O(t).play(),V.set(e,(()=>{this.playParallel($(t),e)})),I(t));j('"animes" should be one or more arrays')}constructor(t,e){super(),this.handler=t,this.params=e??{},this.init()}play(){return this.isPlay=!0,this.startFrameCount=frameCount,this.emit(u.Play),this}abort(){return this.init,this.emit(u.Abort),this}draw(){if(!this.isPlay)return;this.handler(frameCount-this.startFrameCount,this.params)&&(this.init(),this.emit(u.Done,this))}init(){this.isPlay=!1,this.startFrameCount=0}}class p{get baseX(){return this.x-B.x}get baseY(){return this.y-B.y}get centerX(){return this.baseX+30}get centerY(){return this.baseY+30}}class k extends p{constructor(){super();this.blinkAnime=new g((t=>{if(1===t&&q.play("blink"),stroke(255),strokeWeight(30*t/10),fill(this.color),rect(this.x,this.y,e,e),10<=t)return q.stop("blink"),!0}))}draw(){this.blinkAnime.isPlay?this.blinkAnime.draw():(stroke(i),strokeWeight(1),fill(this.color),rect(this.x,this.y,e,e))}}class x extends k{player=r.First;color=s}class b extends k{player=r.Second;color=n}class F extends p{player=void 0;constructor(){super();const t=[150,250,400];this.anime=new g((i=>{i%=t[t.length-1];let o=color(_.player===r.First?s:n);if(i<=t[0]){let e=t[0],s=(e-i)/e;o.setAlpha(76.5*s+20)}else if(i<=t[1])o.setAlpha(20);else{let e=t[1],s=(i-e)/(t[2]-e);o.setAlpha(76.5*s+20)}fill(o),noStroke(),rect(this.x,this.y,e,e)}))}play(){return this.anime.play()}abort(){return this.anime.abort()}draw(){this.anime.draw()}}class A{constructor(){this.init()}init(){this.data=[[new F]]}set(t,e,i){e<0||i<0||(void 0===this.data[e]&&(this.data[e]=[]),this.data[e][i]=t)}add(t,e,i){void 0===this.get(e,i)&&this.set(t,e,i)}get(t,e){if(t<0)return;if(e<0)return;return(this.data[t]??[])[e]}forEach(t){this.data.forEach(((e,i)=>{void 0!==e&&e.forEach(((e,s)=>{t(e,i,s)}))}))}getComboLines(t,e,i){const s=[];let n=[];return n=R(-(i-=1),i).map((i=>this.get(t+i,e))),s.push(n),n=R(-i,i).map((i=>this.get(t,e+i))),s.push(n),n=R(-i,i).map((i=>this.get(t+i,e+i))),s.push(n),n=R(-i,i).map((i=>this.get(t-i,e+i))),s.push(n),s}}class W extends y{constructor(){super(),this.windowResized(),this.fieldData=new A}get x(){return this.baseX+B.x}get y(){return this.baseY+B.y}add(t,e,i){if(_.canPutField!==this.player)return;this.fieldData.set(t,e,i);let s=function(t,e,i,s){let n=s.getComboLines(e,i,5);for(let e of n){let i=D(t,e,5);if(0<i.length)return i}return[]}(_.player,e,i,this.fieldData);0<s.length?this.emit(d.GameSet,s):(this.addCandidates(e,i),V.nextFrame((()=>{let t=function(t,e,i,s){if(_.player!==_.canPutField)return[];let n=[],o=s.getComboLines(e,i,4);for(let e of o){let i=e.slice(0,4);v(t,i,4)&&(e=e.slice(3)),i=e.slice(-4),v(t,i,4)&&(e=e.slice(0,-3));let s=D(t,e,3);0<s.length&&n.push(s)}return n}(_.player,e,i,this.fieldData);M(t),_.addComboCount(t.length),_.action(),this.guideAnimePlay(),q.play("token")})))}addCandidates(t,e){this.fieldData.add(new F,t+1,e),this.fieldData.add(new F,t-1,e),this.fieldData.add(new F,t,e+1),this.fieldData.add(new F,t,e-1)}guideAnimePlay(){this.fieldData.forEach((t=>{t instanceof F&&t.play()}))}init(){this.fieldData.init(),this.enable=!0,this.guideAnimePlay()}mouseClicked(){const{column:t,row:e}=this.toCell(mouseX,mouseY);if(t<0)return;if(e<0)return;return this.fieldData.get(t,e)instanceof F?(this.add(function(){switch(_.player){case r.First:return new x;case r.Second:return new b;default:return j()}}(),t,e),!1):void 0}}class C extends W{constructor(){super(),this.player=r.First}toCell(t,i){return{column:floor((this.x-t)/e),row:floor((this.y-i)/e)}}draw(){if(!this.enable)return;_.canPutField===this.player&&(fill(o),noStroke(),rect(0,0,this.x,this.y));let t=_.canPutField===this.player;t?(strokeWeight(5),_.player===r.First?stroke(s):stroke(n)):(strokeWeight(1),stroke(i)),line(this.x,this.y,this.x,0),line(this.x,this.y,0,this.y),strokeWeight(1),stroke(i),this.fieldData.forEach(((i,s,n)=>{void 0!==i&&(i instanceof F&&!t||(i.x=this.x-(s+1)*e,i.y=this.y-(n+1)*e,i.draw()))}))}windowResized(){this.baseX=windowWidth/2-30,this.baseY=windowHeight-60}}class S extends W{constructor(){super(),this.player=r.Second}toCell(t,i){return{column:floor((t-this.x)/e),row:floor((this.y-i)/e)}}draw(){if(!this.enable)return;_.canPutField===this.player&&(fill(o),noStroke(),rect(this.x,0,windowWidth-B.x,this.y));let t=_.canPutField===this.player;t?(strokeWeight(5),_.player===r.First?stroke(s):stroke(n)):(strokeWeight(1),stroke(i)),line(this.x,this.y,this.x,0),line(this.x,this.y,windowWidth,this.y),strokeWeight(1),stroke(i),this.fieldData.forEach(((i,s,n)=>{void 0!==i&&(i instanceof F&&!t||(i.x=this.x+s*e,i.y=this.y-(n+1)*e,i.draw()))}))}windowResized(){this.baseX=windowWidth/2+30,this.baseY=windowHeight-60}}class P extends y{showAnime=new g((t=>{if(this.coreDraw(t/30),30<=t)return!0}));hideAnime=new g((t=>{this.coreDraw(1);let e=t/20;var i;if(e=(i=e)<.5?16*i*i*i*i*i:1+16*--i*i*i*i*i,fill(50),rect(0,0,windowWidth/2*e,windowHeight),rect(windowWidth-windowWidth/2*e,0,windowWidth,windowHeight),20<=t)return!0}));constructor(){super(),this.init()}init(){this.enable=!1,this.player=void 0}show(t){this.enable=!0,this.player=t,this.showAnime.play()}hide(){this.hideAnime.onOnce(u.Done,(()=>{this.enable=!1,this.player=void 0,this.emit(d.Init)})),this.hideAnime.play()}mouseClicked(){if(this.enable)return this.hide(),!1}draw(){this.enable&&(this.showAnime.isPlay?this.showAnime.draw():this.hideAnime.isPlay?this.hideAnime.draw():this.coreDraw(1))}coreDraw(t){let e=floor(min([windowWidth,windowHeight])/5);background(i),textSize(e),noStroke();let o=color(50);o.setAlpha(255*t),fill(o),text("Game Set",windowWidth/2,windowHeight/2-e),stroke(o),strokeWeight(8),this.player==r.First?(o=color(s),o.setAlpha(255*t),fill(o),text("Win : Red",windowWidth/2,windowHeight/2+e)):(o=color(n),o.setAlpha(255*t),fill(o),text("Win : Blue",windowWidth/2,windowHeight/2+e))}}class E{gameState=l.Play;constructor(t,e,i){this.firstField=t,this.secondField=e,this.gameSetScene=i}init(){B.init(),_.init(),this.gameSetScene.init(),this.secondField.init(),this.firstField.init()}gameSet(t){let e=O(t).player===r.First?0:200,i=new g((i=>{let s,n=H(O(t).centerX+B.x,O(t).centerY+B.y,I(t).centerX+B.x,I(t).centerY+B.y);if(i<=4){s=i/4;const[t,o]=n(0),[r,a]=n(windowWidth*s);X(t,o,r,a,e)}else if(i<=34){5===i&&q.play("laser");const[t,s]=n(0),[o,r]=n(windowWidth);X(t,s,o,r,e)}else if(i<=84){38===i&&q.play("gameset"),s=(i-34)/50;const[t,o]=n(0),[r,a]=n(windowWidth),l=2.5*max([windowWidth,windowHeight]);X(t,o,r,a,e,l*s)}else{if(!(i<=94))return!0;{const[t,i]=n(0),[s,o]=n(windowWidth),r=2.5*max([windowWidth,windowHeight]);X(t,i,s,o,e,r)}}}));U.add(i),i.on(u.Done,(()=>{this.firstField.enable=!1,this.secondField.enable=!1,this.gameSetScene.show(O(t).player)}));let s=t.map((t=>t.blinkAnime));s.push(i),g.playParallel(s,10)}}function D(t,e,i){let s=[];for(let n of e)if(void 0!==n){if(n.player===t?s.push(n):s=[],i<=s.length)return s}else s=[];return[]}function v(t,e,i){return 0<D(t,e,i).length}const Y=(t,e)=>{let i;1===t&&q.play("laser");let s=H(e.x1+B.x,e.y1+B.y,e.x2+B.x,e.y2+B.y);if(t<=4){i=t/4;const[n,o]=s(0),[r,a]=s(windowWidth*i);X(n,o,r,a,e.hue)}else if(t<=64){const[t,i]=s(0),[n,o]=s(windowWidth);X(t,i,n,o,e.hue)}else{if(!(t<=68))return!0;{i=(t-64)/4;const[n,o]=s(windowWidth*i),[r,a]=s(windowWidth);X(n,o,r,a,e.hue)}}};function H(t,e,i,s){return t===i?e=>[t,windowHeight*e/windowHeight]:n=>[n,(s-e)*(n-t)/(i-t)+e]}function T(t,e,i,s,n){t===i?(line(t+n,e,i+n,s),line(t-n,e,i-n,s)):(line(t,e+n,i,s+n),line(t,e-n,i,s-n))}function X(t,i,s,n,o,r){const a=[5,2,6,6],l=a.reduce(((t,e)=>e+t)),h=void 0===r?e:r*l/a[0],d=a.map((t=>h*t/l/2));let c=d[0]/2;stroke(`hsl(${o}, 100%, 100%)`),strokeWeight(d[0]),T(t,i,s,n,c),c+=d[0]/2+d[1]/2,stroke(`hsl(${o}, 100%, 50%)`),strokeWeight(d[1]),T(t,i,s,n,c),c+=d[1]/2+d[2]/2,stroke(`hsla(${o}, 100%, 50%, 0.5)`),strokeWeight(d[2]),T(t,i,s,n,c),c+=d[2]/2+d[3]/2,stroke(`hsla(${o}, 100%, 50%, 0.2)`),strokeWeight(d[3]),T(t,i,s,n,c)}function L(t){t.length<2&&j(`You need at least two tokens. size: ${t.length}`);let e=t.map((t=>t.blinkAnime)),i=I(e),s=new g(Y,{x1:O(t).centerX,y1:O(t).centerY,x2:I(t).centerX,y2:I(t).centerY,hue:O(t).player===r.First?0:200});return U.add(s),e.push(s),g.playParallel(e,10),i}function M(t){if(0!==t.length)if(1===t.length)L(O(t));else{L(O(t)).onOnce(u.Done,(()=>{M($(t))}))}}function z(t,e){for(let i of e){if(!1===G(i,t))return!1}}function G(t,e,...i){if(void 0!==t)return t[e]instanceof Function?t[e](...i):void 0}function R(t,e,i=1){let s=[];for(let n=0;n<=e-t;n+=i)s.push(t+n);return s}function O(t){return t[0]}function $(t){return t.slice(1)}function I(t){return t[t.length-1]}function j(t="It cannot be reached."){throw new Error(t)}let N=[],_=new class extends y{constructor(){super(),this.init()}init(){this.player=r.First,this.actionCount=1,this.canPutField=r.First}action(){this.actionCount-=1,this.actionCount<=0&&this.toggleTurn()}addComboCount(t){0!==t&&(this.actionCount+=t,this.toggleField())}toggleField(){this.canPutField=this.canPutField===r.First?r.Second:r.First,this.emit(f.ToggleField)}toggleTurn(){this.player=this.player===r.First?r.Second:r.First,this.actionCount=1,this.canPutField!==this.player&&(this.canPutField=this.player,this.emit(f.ToggleField)),this.emit(f.ToggleTurn)}},B=new class{x=0;y=0;startX=0;startY=0;oldX=0;oldY=0;init(){this.x=0,this.y=0,this.startX=0,this.startY=0,this.oldX=0,this.oldY=0}touchStarted(){this.startX=mouseX,this.startY=mouseY,this.oldX=this.x,this.oldY=this.y}touchMoved(){cursor("grabbing"),this.x=this.oldX+mouseX-this.startX,this.y=this.oldY+mouseY-this.startY}touchEnded(){cursor("auto")}},U=new class{animes=new Set;add(t){this.animes.add(t),t.onOnce(u.Done,(()=>{this.animes.delete(t)})),t.onOnce(u.Abort,(()=>{this.animes.delete(t)}))}draw(){for(let t of this.animes)t.draw()}},V=new class{callbacks=new Map;set(t,e){let i=this.callbacks.get(frameCount+t)??[];i.push(e),this.callbacks.set(frameCount+t,i)}nextFrame(t){this.set(1,t)}check(){let t=this.callbacks.get(frameCount);if(void 0!==t){for(let e of t)e();this.callbacks.delete(frameCount)}}},q=new class{setup(){this.audioElements={token:this.setupAudioElement("token"),laser:this.setupAudioElement("laser"),gameset:this.setupAudioElement("gameset"),blink:this.setupAudioElement("blink")}}play(t){let e=this.audioElements[t]??j();e.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&(e.currentTime=0,e.play())}stop(t){let e=this.audioElements[t]??j();e.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&e.pause()}setupAudioElement(t){let e=document.getElementById(`audio-${t}`)??j();if(e instanceof HTMLAudioElement)return e;j()}};new class{i18nText=t;constructor(){this.setCountry()}setCountry(t){t?this.country=t:(t=window.navigator.language,this.country=t&&""!==t?t.slice(0,2):"ja")}get(e){let i=t[e];return void 0===i&&j(`i18n keyword is undefined. keyword: ${e}`),i[this.country]??i.ja}};window.setup=function(){createCanvas(windowWidth,windowHeight),textAlign(CENTER,CENTER),textFont("Ranchers"),frameRate(60);let t=new P,e=new C,i=new S,s=new E(e,i,t);s.init(),e.on(d.GameSet,(t=>{s.gameSet(t)})),i.on(d.GameSet,(t=>{s.gameSet(t)})),t.on(d.Init,(()=>{s.init()})),q.setup(),N.push(e),N.push(i),N.push(U),N.push(t)},window.draw=function(){clear(),background(50),z("draw",N),V.check()},window.mouseClicked=function(){return z("mouseClicked",N.reverse())},window.touchStarted=function(){B.touchStarted()},window.touchMoved=function(){return B.touchMoved(),!1},window.touchEnded=function(){B.touchEnded()},window.windowResized=function(){return resizeCanvas(windowWidth,windowHeight),z("windowResized",N)}}();
//# sourceMappingURL=index.20c2c2ca.js.map
